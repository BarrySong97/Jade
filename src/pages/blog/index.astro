---
import BaseLayout from "@/layouts/BaseLayout.astro";
import { BlogListItem } from "@/components/blogs/blog-list-item";
import { getCollection } from "astro:content";

const posts = (await getCollection("blog")).sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);

const BLOG_POSTS = posts.map((post) => ({
  id: post.id.replace(/\.mdx?$/, ""),
  title: post.data.title,
  date: post.data.pubDate.toISOString().split("T")[0],
  coverImage: post.data.heroImage?.src,
}));
---

<BaseLayout
  title="博客 - Astro Template"
  description="分享技术文章、项目经验和学习笔记。涵盖前端开发、全栈技术、TypeScript、React 等主题。"
>
  <div
    class="mx-auto max-w-5xl min-h-[calc(100vh-128px)] border border-border border-t-0 border-b-0 px-4 py-12 sm:px-6 lg:px-8"
  >
    <div class="space-y-2 mb-12">
      <h1 class="text-2xl font-bold sm:text-3xl">博客</h1>
      <p class="text-sm text-muted-foreground">
        共 {BLOG_POSTS.length} 篇文章
      </p>
    </div>

    <div>
      {BLOG_POSTS.map((post) => <BlogListItem client:load post={post} />)}
    </div>
  </div>
</BaseLayout>
