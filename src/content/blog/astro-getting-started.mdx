---
title: "Astro 入门指南"
description: "使用 Astro 构建快速的现代化网站"
pubDate: "2024-01-20"
heroImage: "../../assets/blog-placeholder-4.jpg"
---

Astro 是一个现代化的静态网站生成器，专注于构建快速的内容驱动网站。

## 什么是 Astro？

Astro 是一个全新的静态网站构建工具，它可以帮助你构建更快的网站。Astro 的核心理念是"默认零 JavaScript"。

## 核心特性

### 1. Islands 架构

Astro 使用 Islands 架构，只在需要的地方加载 JavaScript：

```astro
---
import Header from './components/Header.astro';
import InteractiveButton from './components/InteractiveButton.jsx';
---

<html>
  <head>
    <title>My Site</title>
  </head>
  <body>
    <!-- 静态组件，无 JS -->
    <Header />
    
    <!-- 只有这个按钮会加载 JS -->
    <InteractiveButton client:load />
  </body>
</html>
```

### 2. 多框架支持

在同一个项目中使用多个框架：

```astro
---
import ReactCounter from './ReactCounter.jsx';
import VueGreeting from './VueGreeting.vue';
import SvelteForm from './SvelteForm.svelte';
---

<div>
  <ReactCounter client:load />
  <VueGreeting client:visible />
  <SvelteForm client:idle />
</div>
```

## 文件路由

Astro 使用基于文件的路由系统：

```
src/pages/
├── index.astro          → /
├── about.astro          → /about
├── blog/
│   ├── index.astro      → /blog
│   └── [...slug].astro  → /blog/* (动态路由)
└── api/
    └── posts.json.ts    → /api/posts.json (API 端点)
```

### 动态路由

```astro
---
// src/pages/blog/[slug].astro
export async function getStaticPaths() {
  const posts = await fetch('https://api.example.com/posts').then(r => r.json());
  
  return posts.map(post => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

const { post } = Astro.props;
---

<html>
  <head>
    <title>{post.title}</title>
  </head>
  <body>
    <h1>{post.title}</h1>
    <p>{post.content}</p>
  </body>
</html>
```

## Content Collections

Astro 提供了类型安全的内容管理方案：

```typescript
// src/content/config.ts
import { defineCollection, z } from 'astro:content';

const blogCollection = defineCollection({
  type: 'content',
  schema: z.object({
    title: z.string(),
    description: z.string(),
    pubDate: z.date(),
    author: z.string(),
    image: z.object({
      url: z.string(),
      alt: z.string(),
    }),
    tags: z.array(z.string()),
  }),
});

export const collections = {
  'blog': blogCollection,
};
```

使用 Content Collections：

```astro
---
import { getCollection } from 'astro:content';

const blogPosts = await getCollection('blog');
---

<ul>
  {blogPosts.map(post => (
    <li>
      <a href={`/blog/${post.slug}`}>
        {post.data.title}
      </a>
    </li>
  ))}
</ul>
```

## 客户端指令

控制组件何时加载 JavaScript：

```astro
---
import HeavyComponent from './HeavyComponent.jsx';
---

<!-- 页面加载时立即加载 -->
<HeavyComponent client:load />

<!-- 组件可见时加载 -->
<HeavyComponent client:visible />

<!-- 浏览器空闲时加载 -->
<HeavyComponent client:idle />

<!-- 仅在特定媒体查询匹配时加载 -->
<HeavyComponent client:media="(max-width: 768px)" />

<!-- 仅在客户端渲染 -->
<HeavyComponent client:only="react" />
```

## API 路由

创建 API 端点：

```typescript
// src/pages/api/posts.json.ts
import type { APIRoute } from 'astro';

export const GET: APIRoute = async ({ params, request }) => {
  const posts = [
    { id: 1, title: 'First Post' },
    { id: 2, title: 'Second Post' },
  ];

  return new Response(JSON.stringify(posts), {
    status: 200,
    headers: {
      'Content-Type': 'application/json',
    },
  });
};

export const POST: APIRoute = async ({ request }) => {
  const data = await request.json();
  
  // 处理 POST 请求
  
  return new Response(JSON.stringify({ success: true }), {
    status: 201,
    headers: {
      'Content-Type': 'application/json',
    },
  });
};
```

## 集成与插件

Astro 拥有丰富的集成生态系统：

```javascript
// astro.config.mjs
import { defineConfig } from 'astro/config';
import react from '@astrojs/react';
import tailwind from '@astrojs/tailwind';
import mdx from '@astrojs/mdx';
import sitemap from '@astrojs/sitemap';

export default defineConfig({
  integrations: [
    react(),
    tailwind(),
    mdx(),
    sitemap(),
  ],
});
```

## 图片优化

Astro 提供内置的图片优化：

```astro
---
import { Image } from 'astro:assets';
import myImage from '../assets/hero.jpg';
---

<!-- 自动优化图片 -->
<Image 
  src={myImage} 
  alt="Hero image"
  width={800}
  height={600}
/>

<!-- 从 public 目录加载 -->
<Image 
  src="/images/photo.jpg" 
  alt="Photo"
  width={400}
  height={300}
/>
```

## 环境变量

安全地使用环境变量：

```astro
---
// 只在服务器端可用
const secret = import.meta.env.SECRET_API_KEY;

// 可以在客户端使用（必须以 PUBLIC_ 开头）
const publicKey = import.meta.env.PUBLIC_API_KEY;
---

<script>
  // 客户端可以访问
  const key = import.meta.env.PUBLIC_API_KEY;
</script>
```

## 性能优化

### 1. 部分水合

只对需要交互的组件进行水合：

```astro
<StaticHeader />
<InteractiveNav client:load />
<StaticContent />
<InteractiveComments client:visible />
<StaticFooter />
```

### 2. 预渲染

生成静态 HTML，实现最快的首次加载：

```astro
---
export const prerender = true;
---
```

### 3. 按需加载

使用 `client:visible` 延迟加载不在首屏的组件：

```astro
<HeroSection />
<AboutSection client:visible />
<ContactForm client:visible />
```

## 部署

Astro 可以部署到任何支持静态网站的平台：

```bash
# 构建生产版本
npm run build

# 输出在 dist/ 目录
```

支持的平台包括：
- Vercel
- Netlify
- Cloudflare Pages
- GitHub Pages
- 任何支持静态文件的服务器

## 总结

Astro 通过其独特的 Islands 架构和"默认零 JavaScript"理念，帮助开发者构建极快的网站。它的灵活性和强大的功能使其成为现代 Web 开发的理想选择。

