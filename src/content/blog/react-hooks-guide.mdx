---
title: "React Hooks 完全指南"
description: "深入理解 React Hooks 的工作原理和最佳实践"
pubDate: "2024-01-15"
heroImage: "../../assets/blog-placeholder-1.jpg"
---

React Hooks 改变了我们编写 React 组件的方式，让函数组件也能使用状态和其他 React 特性。

## 什么是 Hooks？

Hooks 是 React 16.8 引入的新特性，它让你在不编写 class 的情况下使用 state 和其他 React 特性。

## useState - 状态管理

`useState` 是最常用的 Hook，用于在函数组件中添加状态。

```tsx
import { useState } from 'react';

function Counter() {
  const [count, setCount] = useState(0);

  return (
    <div>
      <p>You clicked {count} times</p>
      <button onClick={() => setCount(count + 1)}>
        Click me
      </button>
    </div>
  );
}
```

### 多个状态变量

你可以在一个组件中多次使用 `useState`：

```tsx
function UserProfile() {
  const [name, setName] = useState('');
  const [age, setAge] = useState(0);
  const [email, setEmail] = useState('');

  return (
    <form>
      <input 
        value={name} 
        onChange={(e) => setName(e.target.value)} 
        placeholder="Name"
      />
      <input 
        value={age} 
        onChange={(e) => setAge(Number(e.target.value))} 
        placeholder="Age"
        type="number"
      />
      <input 
        value={email} 
        onChange={(e) => setEmail(e.target.value)} 
        placeholder="Email"
        type="email"
      />
    </form>
  );
}
```

## useEffect - 副作用处理

`useEffect` 让你在函数组件中执行副作用操作，如数据获取、订阅或手动修改 DOM。

```tsx
import { useState, useEffect } from 'react';

function DataFetcher() {
  const [data, setData] = useState(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    async function fetchData() {
      try {
        const response = await fetch('https://api.example.com/data');
        const result = await response.json();
        setData(result);
      } catch (error) {
        console.error('Error fetching data:', error);
      } finally {
        setLoading(false);
      }
    }

    fetchData();
  }, []); // 空依赖数组表示只在组件挂载时执行一次

  if (loading) return <div>Loading...</div>;
  return <div>{JSON.stringify(data)}</div>;
}
```

### 清理副作用

某些副作用需要清理，例如订阅、定时器等：

```tsx
function Timer() {
  const [seconds, setSeconds] = useState(0);

  useEffect(() => {
    const interval = setInterval(() => {
      setSeconds(prev => prev + 1);
    }, 1000);

    // 清理函数
    return () => clearInterval(interval);
  }, []);

  return <div>Seconds: {seconds}</div>;
}
```

## useContext - 跨组件传值

`useContext` 让你无需手动传递 props 就能在组件树中共享值。

```tsx
import { createContext, useContext, useState } from 'react';

const ThemeContext = createContext('light');

function App() {
  const [theme, setTheme] = useState('light');

  return (
    <ThemeContext.Provider value={theme}>
      <Toolbar />
      <button onClick={() => setTheme(theme === 'light' ? 'dark' : 'light')}>
        Toggle Theme
      </button>
    </ThemeContext.Provider>
  );
}

function Toolbar() {
  return (
    <div>
      <ThemedButton />
    </div>
  );
}

function ThemedButton() {
  const theme = useContext(ThemeContext);
  return <button className={theme}>I am styled by theme context!</button>;
}
```

## 自定义 Hooks

创建自定义 Hooks 可以复用组件逻辑：

```tsx
function useLocalStorage(key: string, initialValue: any) {
  const [storedValue, setStoredValue] = useState(() => {
    try {
      const item = window.localStorage.getItem(key);
      return item ? JSON.parse(item) : initialValue;
    } catch (error) {
      console.log(error);
      return initialValue;
    }
  });

  const setValue = (value: any) => {
    try {
      const valueToStore = value instanceof Function ? value(storedValue) : value;
      setStoredValue(valueToStore);
      window.localStorage.setItem(key, JSON.stringify(valueToStore));
    } catch (error) {
      console.log(error);
    }
  };

  return [storedValue, setValue];
}

// 使用自定义 Hook
function App() {
  const [name, setName] = useLocalStorage('name', 'Bob');

  return (
    <input 
      value={name}
      onChange={(e) => setName(e.target.value)}
    />
  );
}
```

## Hooks 规则

使用 Hooks 时需要遵循两个规则：

1. **只在最顶层调用 Hooks**：不要在循环、条件或嵌套函数中调用 Hooks
2. **只在 React 函数中调用 Hooks**：不要在普通的 JavaScript 函数中调用 Hooks

## 总结

React Hooks 为函数组件带来了强大的能力，让代码更简洁、更易于理解和维护。掌握这些核心 Hooks 是现代 React 开发的基础。

